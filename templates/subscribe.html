{% extends "base.html" %}
{% block title %}Subscribe - Klevaedge{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto px-4 py-6 space-y-5">
    <div>
        <h1 class="text-2xl font-bold text-white">Subscribe</h1>
        <p class="text-gray-400 text-sm">Subscribe to plans and earn profits</p>
    </div>
    <h2 class="text-lg font-bold text-white">Plans</h2>
    <div class="space-y-4">
        {% set plans = [
            {'name': 'Lite', 'min': 20000, 'max': 49500, 'duration': 45, 'roi': 300},
            {'name': 'Pro', 'min': 100000, 'max': 1000000, 'duration': 365, 'roi': 403},
            {'name': 'Classic', 'min': 50000, 'max': 99500, 'duration': 180, 'roi': 350},
            {'name': 'Starter', 'min': 1000, 'max': 19500, 'duration': 14, 'roi': 150},
        ] %}
        {% for plan in plans %}
        <div class="bg-dark-card rounded-2xl border border-dark-border p-5 space-y-4">
            <h3 class="font-bold text-white text-lg">{{ plan.name }}</h3>
            <div>
                <p class="text-gray-400 text-sm">Minimum</p>
                <p class="text-3xl font-bold text-white">${{ "{:,}".format(plan.min) }}</p>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-dark-hover rounded-xl p-3">
                    <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Duration</p>
                    <p class="font-bold text-white">{{ plan.duration }} DAYS</p>
                </div>
                <div class="bg-dark-hover rounded-xl p-3">
                    <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">ROI</p>
                    <p class="font-bold text-green-400">{{ plan.roi }}%</p>
                </div>
            </div>
            <div class="bg-dark-hover rounded-xl p-3">
                <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Maximum</p>
                <p class="font-bold text-white">${{ "{:,}".format(plan.max) }}</p>
            </div>
            <div>
                <label class="text-gray-400 text-sm mb-2 block">Amount:</label>
                <div class="flex bg-dark-hover border border-dark-border rounded-xl overflow-hidden">
                    <input type="number" id="amount-{{ loop.index }}" value="1000" class="flex-1 bg-transparent text-white px-4 py-3 text-sm focus:outline-none" placeholder="1000">
                    <span class="bg-dark-border text-gray-300 px-4 flex items-center text-sm font-semibold">USD</span>
                </div>
                <div class="flex items-center justify-between mt-1">
                    <span class="text-xs text-gray-500">Current balance</span>
                    <a href="{{ url_for('deposit') }}" class="text-xs text-red-400">${{ "%.0f"|format(user['balance']) }} Deposit now</a>
                </div>
            </div>
            <button onclick="openSubModal('{{ plan.name }}', {{ plan.min }}, {{ plan.roi }}, {{ plan.duration }})" class="w-full bg-primary-600 hover:bg-primary-700 text-white py-3 rounded-xl font-semibold transition glow">Subscribe</button>
        </div>
        {% endfor %}
    </div>

    <!-- Subscriptions History -->
    <h2 class="text-lg font-bold text-white pt-2">Subscriptions</h2>
    <div class="bg-dark-card rounded-2xl border border-dark-border overflow-hidden">
        <div class="p-4 border-b border-dark-border"><h3 class="font-semibold text-white">Subscriptions</h3></div>
        <div class="grid grid-cols-2 px-4 py-3 border-b border-dark-border">
            <span class="text-xs text-gray-400 font-semibold">Ref</span>
            <span class="text-xs text-gray-400 font-semibold text-right">Plan</span>
        </div>
        {% if subscriptions %}
            {% for s in subscriptions %}
            <div class="grid grid-cols-2 px-4 py-3 border-b border-dark-border last:border-0">
                <span class="text-sm text-white">{{ s['ref'] }}</span>
                <div class="text-right">
                    <span class="text-sm text-white">{{ s['plan'] }}</span><br>
                    <span class="text-xs text-green-400">+${{ "%.2f"|format(s['earnings']) }}</span>
                    <span class="text-xs ml-1 px-2 py-0.5 rounded-full {% if s['status']=='Active' %}bg-green-900 text-green-400{% else %}bg-gray-800 text-gray-400{% endif %}">{{ s['status'] }}</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="p-8 text-center text-gray-500 text-sm">No subscriptions yet</div>
        {% endif %}
    </div>
</div>
<!-- Subscribe Modal -->
<div id="sub-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-end justify-center">
    <div class="bg-dark-card rounded-t-2xl p-6 w-full max-w-md space-y-4 border-t border-dark-border">
        <h3 class="text-lg font-bold text-white">Subscribe to <span id="sub-modal-name"></span></h3>
        <form method="POST" action="{{ url_for('subscribe') }}">
            <input type="hidden" name="plan" id="sub-plan-input">
            <input type="hidden" name="roi" id="sub-roi-input">
            <input type="hidden" name="days" id="sub-days-input">
            <div class="space-y-3">
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Amount (USD)</label>
                    <input type="number" name="amount" id="sub-amount" step="0.01" required
                        class="w-full bg-dark-hover border border-dark-border text-white rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-primary-500">
                    <p class="text-xs text-gray-500 mt-1">Balance: ${{ "%.2f"|format(user['balance']) }}</p>
                </div>
                <button type="submit" class="w-full bg-primary-600 hover:bg-primary-700 text-white py-3 rounded-xl font-semibold transition">Confirm Subscription</button>
                <button type="button" onclick="document.getElementById('sub-modal').classList.add('hidden')" class="w-full text-gray-400 py-2 text-sm">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
function openSubModal(plan, minAmt, roi, days) {
    document.getElementById('sub-modal-name').textContent = plan;
    document.getElementById('sub-plan-input').value = plan;
    document.getElementById('sub-roi-input').value = roi;
    document.getElementById('sub-days-input').value = days;
    document.getElementById('sub-amount').value = minAmt;
    document.getElementById('sub-modal').classList.remove('hidden');
}
}</script>
{% endblock %}
